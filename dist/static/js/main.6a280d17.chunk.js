(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{215:function(e,t,a){e.exports=a(434)},220:function(e,t,a){},388:function(e,t,a){},407:function(e,t,a){},434:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(209),i=a.n(c),s=(a(220),a(15)),l=a(16),o=a(18),u=a(17),m=a(19),h=a(442),d=a(443),p=a(440),f=a(437),E=(a(222),a(8)),b=a(45),g=a.n(b);a(238),a(239);g.a.initializeApp({apiKey:"AIzaSyAIIRu8xg6Jl-reewB9IKYk9NPzSz2rZNM",authDomain:"react-redux-firebase-1512214.firebaseapp.com",databaseURL:"https://react-redux-firebase-1512214.firebaseio.com",projectId:"react-redux-firebase-1512214",storageBucket:"",messagingSenderId:"375933914937"}),g.a.firestore().settings({timestampsInSnapshots:!0});var v=new g.a.auth.GoogleAuthProvider,O=(g.a.storage(),g.a),N=Object(E.b)(function(e){return{auth:e.firebase.auth}},function(e){return{signOut:function(){return e(function(e,t,a){var n=a.getFirebase,r=a.getFirestore,c=n(),i=r(),s=c.auth().O;c.auth().signOut().then(function(){e({type:"SIGNOUT_SUCCESS"}),i.update({collection:"users",doc:s},{status:"offline"})})})}}})(function(e){return r.a.createElement("ul",{className:"right"},r.a.createElement("li",null,r.a.createElement("a",{onClick:e.signOut},"Log Out")),r.a.createElement("li",null,r.a.createElement("div",{className:"btn pink lighten"},"Welcome ",e.auth.email,"!!")))}),y=function(){return r.a.createElement("div",null)},j=Object(E.b)(function(e){return{auth:e.firebase.auth}})(function(e){var t=e.auth.uid?r.a.createElement(N,null):r.a.createElement(y,null);return r.a.createElement("div",null,r.a.createElement("nav",{className:"nav-wrapper grey darken-3"},r.a.createElement(f.a,{to:"/",className:"brand-logo"},"1512214-FireBase-ChatApp"),t),r.a.createElement("br",null),r.a.createElement("br",null))}),S=a(20),w=a(11),C=a(441),x=(a(388),a(438)),U=a(212),k=a.n(U);function I(e,t){return e>t?e+t:t+e}var F=a(60),D=a.n(F),T=a(132),_=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).handleTypeContents=function(e){if(a.props.match.params&&a.props.match.params.id&&"Enter"===e.key){e.preventDefault();var t=e.target.value;e.target.value="",a.setState({content:t},function(){a.handleSend(),a.setState({content:""})})}else a.props.match&&!a.props.match.params.id&&"Enter"===e.key&&(e.preventDefault(),e.target.value="")},a.handleSend=function(e){console.log(e),a.props.match.params?a.props.sendContents({contents:a.props.Chat.contents,content:a.state.content,userChatWith:a.props.match.params.id},function(){a.handleAutoScrollDown()}):e.preventDefault()};var n=a.props.Chat;return a.state={contents:n&&n.contents?n.contents:[],content:""},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"handleAutoScrollDown",value:function(){var e=document.getElementById("box");e.scrollTop=e.scrollHeight-e.clientHeight,alert("OKKKK")}},{key:"componentDidMount",value:function(){if(this.props.match.params&&this.props.match.params.id){var e=this.props.match.params.id;this.props.infoUserChatWith(e),this.handleAutoScrollDown()}}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(e.match.params&&e.match.params.id){var t=e.match.params.id;return e.infoUserChatWith(t),r.a.createElement(C.a,{to:"/chatwith/"+t})}}},{key:"render",value:function(){var e=this.props.profile,t=this.props.Chat,a=this.props.userChatWith,n=e.UID;return r.a.createElement("div",{className:"chat"},r.a.createElement("div",null,a?r.a.createElement("div",{className:"chat-header clearfix"},r.a.createElement("div",{className:"logo"},r.a.createElement("img",{width:"55",src:a.photoURL,alt:"logo"})),r.a.createElement("div",{className:"chat-about"},r.a.createElement("div",{className:"chat-with"},"Chat with ",a.display_name)),r.a.createElement("i",{className:"fa fa-star"})):r.a.createElement("div",{className:"chat-header clearfix"})),r.a.createElement("div",{className:"chat-history",id:"box"},r.a.createElement("ul",null,t.contents&&t.contents.map(function(t,c){return t.content?r.a.createElement("li",{className:n===t.uid?"clearfix":"",key:c},r.a.createElement("div",{className:n===t.uid?"message-data align-right":"message-data"},n===t.uid?r.a.createElement("div",null,r.a.createElement("span",{className:"message-data-time"},Object(T.a)(new Date(t.chatTime),"HH:mm:ss, dd/MM/yyyy"))," \xa0 \xa0",r.a.createElement("span",{className:"message-data-name"},e.display_name)," ",r.a.createElement("i",{className:"fa fa-circle me"})):r.a.createElement("div",null,a&&r.a.createElement("div",null,r.a.createElement("span",{className:"message-data-name"},r.a.createElement("i",{className:"fa fa-circle online"})," ",a.display_name),r.a.createElement("span",{className:"message-data-time"},Object(T.a)(new Date(t.chatTime),"HH:mm:ss, dd/MM/yyyy"))))),r.a.createElement("div",{className:n===t.uid?"message other-message float-right":"message my-message"},t.content?r.a.createElement("p",{dangerouslySetInnerHTML:{__html:function(e){var t="";return e.split(" ").map(function(e,a){if(k()(e)){var n='<a href="'.concat(e,'"><img width="150" src="').concat(e,'" alt="img-chat" /></a>');t+=" ",t+=n,t+=" "}else t+=" ",t+=e}),t}(t.content)}}):null)):null}))),r.a.createElement("div",null,a?r.a.createElement("div",{className:"chat-message clearfix"},r.a.createElement("form",null,r.a.createElement("textarea",{name:"message-to-send",id:"message-to-send",placeholder:"Type message!!",rows:3,defaultValue:"",onKeyPress:this.handleTypeContents}),r.a.createElement("button",{type:"button",onClick:this.handleSend},"Send"))):r.a.createElement("div",{className:"chat-message clearfix"},r.a.createElement("form",null,r.a.createElement("textarea",{name:"message-to-send",id:"message-to-send",placeholder:"Chose someone in list to chat with them!!",rows:3,readOnly:!0}),r.a.createElement("button",{type:"button"},"Send")))))}}]),t}(n.Component),R=Object(x.a)(Object(w.d)(S.withFirestore,Object(E.b)(function(e,t){var a=D.a.values(e.firestore.data.chat),n=e.firebase.profile.UID,r="";""!=t.match.params.id&&(r=t.match.params.id);var c=I(n,r);return(a=a.filter(function(e){return e.id===c})).length&&(a=a[0]),{Chat:a,profile:e.firebase.profile,userChatWith:e.chat.infoUser}},function(e,t){return""!=t.match.params.id&&t.match.params.id,{infoUserChatWith:function(t){return e(function(e){return function(t,a,n){var r=n.getFirebase,c=(0,n.getFirestore)();r(),c.collection("users").doc(e).get().then(function(e){var a=e.data();t({type:"INFO_USER_CHAT_WITH",data:a})})}}(t))},sendContents:function(t){return e(function(e){return function(t,a,n){var r=n.getFirebase,c=(0,n.getFirestore)(),i=r();console.log(e);var s=i.auth().O;if(e.content){var l=I(s,e.userChatWith),o=[];e.contents&&(o=e.contents);var u=new Date;o.push({uid:s,chatTime:u.toString(),content:e.content}),c.get({collection:"chat",where:["id","==",l]}).then(function(e){if(e.docs.length){var t=e.docs[0].id;c.update({collection:"chat",doc:t},{contents:o,lastChatTime:u.toString()})}else c.collection("chat").doc(l).set({id:l,lastChatTime:u.toString(),contents:o})})}}}(t))}}}))(_)),A=a(214),L=function(e){function t(e){return Object(s.a)(this,t),Object(o.a)(this,Object(u.a)(t).call(this,e))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.user;return r.a.createElement("div",null,r.a.createElement(f.a,{to:"/chatwith/"+e.UID},r.a.createElement("li",{className:e.UID===this.props.match.params.id?"clearfix active":"clearfix"},r.a.createElement("img",{width:"55",src:e.photoURL,alt:"avatar"}),r.a.createElement("div",{className:"about"},r.a.createElement("div",{className:"name"},e.display_name),r.a.createElement("div",{className:"status"},r.a.createElement("i",{className:"online"===e.status?"fa fa-circle online":"fa fa-circle offline"}),e.status)))))}}]),t}(n.Component),P=Object(x.a)(Object(w.d)(S.withFirestore,Object(E.b)(function(e){return{}},function(e,t){return{}}))(L)),W=a(439),G=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(o.a)(this,Object(u.a)(t).call(this,e))).handleSearch=function(e){"Enter"===e.key&&(e.preventDefault(),console.log(e.target.value),a.setState({displayName:e.target.value},function(){if(""!=a.state.displayName){var e=a.props.list,t=[];if(e.map(function(e,n){e.display_name.indexOf(a.state.displayName)>=0&&t.push(n)}),0!=t.length){for(var n=[],r=0;r<t.length;r++)n.push(e[t[r]]);a.setState({search:n})}else a.setState({search:[]})}}))},a.state={displayName:"",search:[]},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"people-list",id:"people-list"},r.a.createElement("div",{className:"search"},r.a.createElement("input",{type:"text",placeholder:"Search",onKeyPress:this.handleSearch}),r.a.createElement("i",{className:"fa fa-search"})),r.a.createElement("ul",{className:"list"},this.state.displayName&&this.state.search.length?r.a.createElement("div",null,this.state.search.map(function(e,t){return r.a.createElement(P,{user:e,key:t})})):r.a.createElement("div",null,!!this.props.list.length&&""===this.state.displayName&&this.props.list.map(function(e,t){return r.a.createElement(P,{user:e,key:t})}))))}}]),t}(n.Component),H=Object(x.a)(Object(w.d)(S.withFirestore,Object(E.b)(function(e){var t=[],a=[];t=e.firestore.data.users;var n=e.firebase.auth,r=[];if(t){t=Object.entries(t);for(var c=0;c<t.length;c++)t[c][1].UID!=n.uid&&r.push(t[c][1]);var i=D.a.values(e.firestore.data.chat);if(i){i.sort(function(e,t){return Object(W.a)(new Date(e.lastChatTime),new Date(t.lastChatTime))});for(var s=0;s<i.length;s++)for(var l=0;l<r.length;l++)I(n.uid,r[l].UID)===i[s].id&&a.push(r[l]);for(var o=function(e){r=r.filter(function(t){return t.UID!=a[e].UID})},u=0;u<a.length;u++)o(u)}}return{list:a.concat(Object(A.a)(r)),currentPeople:n}},function(e){return{}}))(G)),B=function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props;e.projects;e.auth.uid&&this.props.updateStatusPeople()}},{key:"render",value:function(){var e=this.props;e.projects;return e.auth.uid?r.a.createElement("div",{className:"container clearfix"},r.a.createElement(H,null),r.a.createElement(R,null)):r.a.createElement(C.a,{to:"/signin"})}}]),t}(n.Component),K=Object(w.d)(Object(E.b)(function(e){return{projects:e.firestore.ordered.projects,auth:e.firebase.auth}},function(e){return{updateStatusPeople:function(){return e(function(e,t,a){var n=a.getFirebase,r=a.getFirestore,c=n(),i=r(),s=c.auth().O;i.update({collection:"users",doc:s},{status:"online"}).then(function(){e({type:"UPDATE_STATUS_SUCCESS"})}).catch(function(t){e({type:"UPDATE_STATUS_ERROR"})})})}}}),Object(S.firestoreConnect)(["users","chat"]))(B),M=(a(407),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(o.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault()},a.handleGoogleSignin=function(){a.props.loginWithGoogle()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.authError;return e.auth.uid?r.a.createElement(C.a,{to:"/"}):r.a.createElement("div",{className:"text-center",style:{width:"40%",margin:"40px auto",backgroundColor:"white"}},r.a.createElement("form",{id:"formLogin",onSubmit:this.handleSubmit},r.a.createElement("h5",{className:"grey-text text-darken-3"},"Sign In"),r.a.createElement("div",{className:"input-field"},r.a.createElement("input",{type:"email",id:"email",className:"validate"}),r.a.createElement("label",{htmlFor:"email"},"Email")),r.a.createElement("div",{className:"input-field"},r.a.createElement("input",{type:"password",id:"password",className:"validate"}),r.a.createElement("label",{htmlFor:"password"},"Password")),r.a.createElement("div",{className:"input-field text-center"},r.a.createElement("button",{className:"btn teal lighten-1 z-depth-0",onClick:this.handleSubmit},"Login"),r.a.createElement("div",{className:"red-text center"},t?r.a.createElement("span",null,"Login failed!!! Wrong email or password"):null))),r.a.createElement("p",{className:"grey-text text-darken-3"},"You don't have account ?"),r.a.createElement("a",{href:"/signup"},"Sign up now"),r.a.createElement("div",{className:"text-center"},r.a.createElement("button",{className:"loginBtn loginBtn--google",onClick:this.handleGoogleSignin.bind(this)},"Login with Google")))}}]),t}(n.Component)),z=Object(E.b)(function(e){return{authError:e.auth.authError,auth:e.firebase.auth}},function(e){return{loginWithGoogle:function(){return e(function(e,t,a){var n=a.getFirebase,r=a.getFirestore,c=n(),i=r();c.auth().signInWithPopup(v).then(function(t){e({type:"LOGIN_SUCCESS"});var a=t.user;i.collection("users").doc(t.user.uid).set({display_name:a.displayName,username:a.displayName,photoURL:a.photoURL,email:a.email,phoneNumber:a.phoneNumber,status:"offline",UID:a.uid})}).catch(function(t){e({type:"LOGIN_ERROR",err:t})})})}}})(M),J=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(o.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.props.auth.uid?r.a.createElement(C.a,{to:"/"}):r.a.createElement("div",{className:"text-center",style:{width:"40%",margin:"40px auto",backgroundColor:"white"}},r.a.createElement("form",{className:"white",onSubmit:this.handleSubmit},r.a.createElement("h5",{className:"grey-text text-darken-3"},"Sign Up"),r.a.createElement("div",{className:"input-field"},r.a.createElement("input",{type:"email",id:"email",className:"validate"}),r.a.createElement("label",{htmlFor:"email"},"Email")),r.a.createElement("div",{className:"input-field"},r.a.createElement("input",{type:"password",id:"password",className:"validate"}),r.a.createElement("label",{htmlFor:"password"},"Password")),r.a.createElement("div",{className:"input-field"},r.a.createElement("input",{type:"text",id:"firstName",className:"validate"}),r.a.createElement("label",{htmlFor:"firstName"},"First Name")),r.a.createElement("div",{className:"input-field"},r.a.createElement("input",{type:"text",id:"lastName",className:"validate"}),r.a.createElement("label",{htmlFor:"lastName"},"Last Name")),r.a.createElement("div",{className:"input-field text-center"},r.a.createElement("button",{className:"btn teal lighten-1 z-depth-0",onClick:this.handleSubmit},"Sign Up"))),r.a.createElement("p",{className:"grey-text text-darken-3"},"You had account ?"),r.a.createElement("a",{href:"/signin"},"Log in now"))}}]),t}(n.Component),Y=Object(E.b)(function(e){return{auth:e.firebase.auth}},function(e){return{}})(J),V=function(e){function t(){return Object(s.a)(this,t),Object(o.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(h.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(j,null),r.a.createElement(d.a,null,r.a.createElement(p.a,{exact:!0,path:"/",component:K}),r.a.createElement(p.a,{exact:!0,path:"/chatwith/:id",component:K}),r.a.createElement(p.a,{path:"/signin",component:z}),r.a.createElement(p.a,{path:"/signup",component:Y}))))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Z=a(37),$={authError:null},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$;switch((arguments.length>1?arguments[1]:void 0).type){case"LOGIN_ERROR":return Object(Z.a)({},e,{authError:"Login failed"});case"LOGIN_SUCCESS":case"UPDATE_STATUS_SUCCESS":return Object(Z.a)({},e,{authError:null});case"UPDATE_STATUS_ERROR":return Object(Z.a)({},e,{authError:"Update status failed"});case"SIGNOUT_SUCCESS":default:return e}},Q=a(62),X={infoUser:null},ee=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"INFO_USER_CHAT_WITH":return Object(Z.a)({},e,{infoUser:t.data});default:return e}},te=Object(w.c)({auth:q,firestore:Q.firestoreReducer,firebase:S.firebaseReducer,chat:ee}),ae=a(213),ne=Object(w.e)(te,Object(w.d)(Object(w.a)(ae.a.withExtraArgument({getFirebase:S.getFirebase,getFirestore:Q.getFirestore})),Object(Q.reduxFirestore)(O),Object(S.reactReduxFirebase)(O,{userProfile:"users",presence:"presence",sessions:"sessions",attachAuthIsReady:!0,useFirestoreForProfile:!0})));ne.firebaseAuthIsReady.then(function(){i.a.render(r.a.createElement(E.a,{store:ne},r.a.createElement(V,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})})}},[[215,2,1]]]);
//# sourceMappingURL=main.6a280d17.chunk.js.map